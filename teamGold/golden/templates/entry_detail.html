{% extends "components/base.html" %}
{% load static %}

<!DOCTYPE HTML> 
<html lang="en">
  <head>
    {% block head %}
    <title>Golden - Entry-Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'golden/css/global.css' %}">
    <link rel="stylesheet" href="{% static 'golden/css/stream.css' %}">
    <link rel="stylesheet" href="{% static 'golden/css/entry_detail.css' %}">
    {% endblock %}
  </head>
  <body>
    {% block content %}
    <br><br>

    <!-- Opened when user presses comment button, shows entry plus comments below-->
    <article data-entry-id="{{ entry.id }}" class="entry">

      <!-- Entry Header Section -->
      <header class="article-header">
        <a href="#">{{ entry.author }}</a>
          <span class="visibility-badge" data-visibility="{{ entry.visibility }}">
            {% if entry.visibility == "PUBLIC" %}
              <img src="{% static 'golden/icons/entry-all-icon.png' %}" alt="Public">
            {% elif entry.visibility == "UNLISTED" %}
              <img src="{% static 'golden/icons/entry-unlisted-icon.png' %}" alt="Unlisted">
            {% elif entry.visibility == "FRIENDS" %}
              <img src="{% static 'golden/icons/friends-icon.png' %}" alt="Friends">
            {% endif %}
          </span>
          <p>{{ entry.published|date:"Y-m-d H:i" }}</p>
          {% if entry.is_updated and entry.is_updated != entry.published %}
            <p class="updated-footer">Edited: {{ entry.is_updated|date:"Y-m-d H:i" }}</p>
          {% endif %}
      </header>

      <!-- Entry Content Section -->
      <section class="entry-body">
        {% if entry.title %}
          <h3 class="text-lg font-semibold mb-1">{{ entry.title }}</h3>
        {% endif %}

        <div style="display: flex;">
          {% for img_url in entry.get_all_images%}
            <img src="{{ img_url }}" alt="Entry image" class="entry-image">
          {% endfor %}
        </div>
        {{ entry.content|safe }}
      </section>

      <!-- Entry Fotter Section -->
      <footer style="padding-top: 5px;">
        <form method="post" action="{% url 'add_like' %}" style="display:inline">
        {% csrf_token %}
          <input type="hidden" name="object" value="{{ entry.id }}">
            
          <!-- TODO: add a like checker -->
          <button type="submit" class="like-btn" aria-label="Like Entry">
            <img src="{% static 'golden/icons/like-icon.png' %}"><span>{{ entry.likes.count }} Stars</span>
          </button> 
        </form>
        
        <button class="share-btn" alt="Copy Link" data-entry-url="{% if entry.get_uuid %}{% url 'entry_detail' entry.get_uuid %}{% else %}#{% endif %}">
          <img src="{% static 'golden/icons/share-icon.png' %}">Share
        </button>

        <!-- Edit and Delete buttons (only for entry owner) -->
        {% if request.user == entry.author %}
          <form method="post" action="{% url 'new_edit_entry_view' %}" style="display:inline">
          {% csrf_token %}
            <input type="hidden" name="entry_edit" value="{{ entry.id }}">
              <button type="submit" class="btn">
                <img src="{% static 'golden/icons/edit-profile-icon.png' %}"><span>
          </form>

          <form method="post" action="{% url 'entry_detail' entry.get_uuid %}" style="display:inline" onsubmit="return confirm('Are you sure you want to delete this entry?');">
          {% csrf_token %}
            <input type="hidden" name="entry_delete" value="{{ entry.id }}">
              <button type="submit" class="btn">
                <img src="{% static 'golden/icons/delete-icon.png' %}"><span>
              </button>
          </form>
        {% endif %}
      </footer>
    </article><br>

    <!-- Comment Field -->
    <form id="commentForm" method="post" action="{% url 'add_comment' %}">
      {% csrf_token %}
      <p>Reply</p>
      <input type="hidden" name="entry_id" value="{{ entry.id }}">
      <textarea name="content" type="input" aria-label="Comment Input" placeholder="Begin comment here..." autocomplete="off" required id="id_content"></textarea>
      <button type="submit" class="btn">Reply</button>
    </form>

    <!-- Comments Section -->
    <section id="entry-comments">
      <div class="comment-btn">
        <img src="{% static 'golden/icons/comment-icon.png' %}">
            <span>{{ comments.count }} Comments</span>
      </div>

      {% for comment in comments %}
      <section class="single-comment">
        <header>
          <span style="color: var(--primary-colour)">{{ comment.author.username }}</span>
            <span>{{ comment.published|date:"Y-m-d H:i" }}</span>
          </header>
          <p>{{ comment.content|safe }}</p> 
          <form method="post" action="{% url 'add_like' %}" style="display:inline">
              {% csrf_token %}
              <input type="hidden" name="object" value="{{ comment.id }}">
              <button type="submit" class="like-btn" aria-label="Like Comment">
                <img src="{% static 'golden/icons/like-icon.png' %}"><span>{{ comment.like_count }} Stars</span>
              </button>
          </form>
          <div class="divider"></div>
      </section>
      {% endfor %}
    </section>
    {% endblock %}
  <body>

</html>