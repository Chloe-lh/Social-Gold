{% extends "base.html" %}

{% load static %}

{% block head %}
<link rel="stylesheet">
<style>
.search-bar {
    width: 100%;
    max-width: 100%;
    padding: 12px 20px;
    font-size: 1rem;
    box-sizing: border-box;
    margin-bottom: 20px;
}
.author-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    margin-bottom: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    transition: background-color 0.2s;
    cursor: pointer;
}
.author-row:hover {
    background-color: #f0f0f0;
}
.follow-btn {
    padding: 6px 12px;
    border: 2px solid #000; 
    background: #E7B393;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}
.follow-btn:hover {
    background-color: darkgoldenrod;
}
</style>
{% endblock %}

{% block content %}
<section class="search-section">
    <header>
        <h2>Search Authors</h2>
    </header>

    <form method="GET" action="{% url 'search_authors' %}" style="display: flex; width: 100%; gap: 10px; margin-bottom: 20px; height: 48px;">
        <input type="text" name="q" class="search-bar" placeholder="Search by username" value="{{ query }}" 
               style="flex: 1; padding: 0 20px; font-size: 1rem; box-sizing: border-box; height: 100%;">
        <button type="submit" 
                style="flex-shrink: 0; padding: 0 20px; font-size: 1rem; border: 2px solid #000; background: #E7B393; border-radius: 4px; cursor: pointer; height: 100%;">
            Search
        </button>
    </form>

    <div class="author-list">
        {% if authors %}
            <ul style="list-style: none; padding: 0;">
                {% for author in authors %}
                    {% if author != request.user %}
                        <li class="author-row">
                            <span>{{ author.username }}</span>

                            {% if page_type == 'followers' %}
                                <form method="POST" action="{% url 'followers' %}" style="display:inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="author_id" value="{{ author.id }}">
                                    <button class="follow-btn">Remove</button>
                                </form>
                            {% elif page_type == 'following' %}
                                <form method="POST" action="{% url 'following'%}" style="display:inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="author_id" value="{{ author.id }}">
                                    <button class="follow-btn">Unfollow</button>
                                </form>
                            {% else %}
                                <form method="POST" action="{% url 'search_authors'%}" style="display:inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="author_id" value="{{ author.id }}">
                                    {% if author.follow_state == "REQUESTED" %}
                                        <button class="follow-btn" disabled>Requested</button>
                                    {% elif author.follow_state == "ACCEPTED" %}
                                        <button class="follow-btn" disabled>Following</button>
                                    {% else %}
                                        <button class="follow-btn">Follow</button>
                                    {% endif %}
                                </form>
                            {% endif %}

                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% else %}
            <p>No authors found.</p>
        {% endif %}
    </div>
</section>
{% endblock %}
