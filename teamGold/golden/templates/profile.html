{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'golden/css/profile.css' %}">
{% endblock %}

{% block content %}

<body>
  <section class="edit-profile-button">
    <button id="edit-profile-btn" class="nav">
        <img src="{% static 'golden/icons/edit-profile-icon.png' %}"/>
        <span class="sr-only">Edit Profile</span>
    </button>
  </section>

  <!-- Editing Profile Form -->
  <section id="edit-profile-form" style="display:none; margin-top: 1rem;">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        {{ form.username.label }}<br>
        {{ form.username }}<br><br>

        <label for="profileImage">Profile Picture:</label><br>
        <input type="file" name="profileImage" accept="image/*"><br><br>

        <label for="description">Bio / About Me:</label><br>
        <textarea name="description" rows="4" cols="50" placeholder="Write something about yourself...">
            {{ user.description }}
        </textarea>
        <br><br>

        {{ form.github.label }}<br>
        {{ form.github }}<br><br>

        {{ form.web.label }}<br>
        {{ form.web }}<br><br>

        <button type="submit" name="edit_profile">Save Profile</button>
    </form>
  </section>

  <!-- Profile Description -->
  <section class="description">
    <p style="font-style: italic; color: #555;">
      {{ author.description|default:"This user hasn't added a bio yet." }}
    </p>
  </section>

  <!-- Tab Section -->
  <section class="tabs-section"> 
    <nav class="tabs">
      <button class="tab-btn active" data-tab="entries">entries</button>
      <button class="tab-btn" data-tab="followers">followers</button>
      <button class="tab-btn" data-tab="following">following</button>
      <button class="tab-btn" data-tab="requests">requests</button>
    </nav>

    <section class="tab-panels">
      <section class="tab-panel active" data-tab-panel="entries">
        {% if entries %}
          {% for entry in entries %}
            <article class="entry">
              <p><strong>@{{ author.username }}</strong> Â· {{ entry.published|date:"Y/m/d" }}</p>
              <div class="content">
                {% for img in entry.images.all %} 
                  <img src="{{ img.image.url }}" alt="entry image" class="entry-img">
                {% endfor %}
                {{ entry.content|safe }}
              </div>
            </article>
          {% endfor %}
        {% else %}
          <p>You have no entries yet.</p>
        {% endif %}
      </section>

      <section class="tab-panel" data-tab-panel="followers">
        {% if followers %}
          {% for f in followers %}
            <div class="author-list-item">{{ f.username }}</div>
            <hr>
          {% endfor %}
        {% else %}
          <p>You're a lonely loser.</p>
        {% endif %}
      </section>

      <section class="tab-panel" data-tab-panel="following">
        {% if following %}
          {% for f in following %}
            <div class="author-list-item">{{ f.username }}</div>
            <hr>
          {% endfor %}
        {% else %}
          <p>Narcissist coded.</p>
        {% endif %}
      </section>

      <section class="tab-panel" data-tab-panel="requests">
        {% if follow_requests %}
          {% for r in follow_requests %}
            <div class="author-list-item">{{ r.actor.username }} wants to follow you</div>
            <hr>
          {% endfor %}
        {% else %}
          <p>No pending requests.</p>
        {% endif %}
      </section>
    </section>
  </section>
</body>

<!-- Edit Profile Form -->
<script>
document.getElementById('edit-profile-btn').addEventListener('click', function(){
    const form = document.getElementById('edit-profile-form');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
});
</script>

<!-- Activation of Profile Tabs -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabPanels = document.querySelectorAll(".tab-panel");

  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.tab;
      const targetPanel = document.querySelector(`[data-tab-panel="${target}"]`);

      // Remove Active, so that css can catch the change
      tabButtons.forEach(b => b.classList.remove("active"));
      tabPanels.forEach(p => p.classList.remove("active"));

      // Activate clicked + matching panel
      btn.classList.add("active");
      if (targetPanel) targetPanel.classList.add("active");
    });
  });
});
</script>

{% endblock %}
